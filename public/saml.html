<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configure SAML2 authentication &mdash; elabftw 5.1.15 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=6d288cbf"></script>
        <script src="_static/doctools.js?v=9bcbadda"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debug" href="debug.html" />
    <link rel="prev" title="Configure LDAP authentication" href="ldap.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            elabftw
          </a>
              <div class="version">
                5.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install on a GNU/Linux server</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-cloud.html">Install in the cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-nas.html">Install on a NAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-nolinux.html">Install on Mac or Windows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="generalities.html">Generalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-guide.html">Admin guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="sysadmin-guide.html">Sysadmin guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-export.html">Import / Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="backup.html">How to backup</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-to-update.html">How to update</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker-doc.html">About Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade-to-docker.html">Upgrade a normal install to a Docker install</a></li>
<li class="toctree-l1"><a class="reference internal" href="ldap.html">Configure LDAP authentication</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configure SAML2 authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup-the-service-provider">Setup the Service Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-the-identity-provider">Setup the IDentity Provider</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#attributes-for-the-idp">Attributes for the IDP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#about-the-userid-internal-id">About the Userid / Internal ID</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#disable-local-login-register">Disable local login/register</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debug</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="thanks.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">elabftw</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configure SAML2 authentication</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/saml.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configure-saml2-authentication">
<span id="saml"></span><h1>Configure SAML2 authentication<a class="headerlink" href="#configure-saml2-authentication" title="Link to this heading"></a></h1>
<img alt="authentication" class="align-center" src="_images/auth.png" />
<p>This page describes the steps necessary to setup SAML2 authentication on eLabFTW with an IDentity Provider (IDP). It assumes that you already know what we’re talking about.</p>
<p>The IDP can lookup identity on an LDAP directory and deal with two factors authentication.</p>
<section id="setup-the-service-provider">
<h2>Setup the Service Provider<a class="headerlink" href="#setup-the-service-provider" title="Link to this heading"></a></h2>
<p>The service provider is the elabftw install. Head to the Sysadmin panel, click the SAML tab.</p>
<ul class="simple">
<li><p>Debug mode: Set to “No”. We don’t want to print errors</p></li>
<li><p>Strict mode: Set to “Yes”. Otherwise the mechanism is not secure</p></li>
<li><p>Base url: Where did you install elabftw? Example: <a class="reference external" href="https://elabftw.example.edu">https://elabftw.example.edu</a></p></li>
<li><p>entityId: The same as base URL</p></li>
<li><p>SAML protocol binding: basically it can be POST or HTTP-redirect. Depending on your IDP, set the correct value here</p></li>
<li><p>Single Logout Service: The same as entityId</p></li>
<li><p>Single Logout Service protocol binding: basically it can be POST or HTTP-redirect. Depending on your IDP, set the correct value here</p></li>
<li><p>NameIDFormat: match the supported NameIDFormat of the IDP, eLabFTW doesn’t use this but it needs to be specified most of the time. Example values:</p>
<ul>
<li><p><a class="reference external" href="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</a> [default]</p></li>
<li><p><a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</a></p></li>
<li><p><a class="reference external" href="urn:oasis:names:tc:SAML:2.0:nameid-format:transient">urn:oasis:names:tc:SAML:2.0:nameid-format:transient</a></p></li>
<li><p><a class="reference external" href="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified">urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</a></p></li>
</ul>
</li>
<li><p>x509 certificate: Generate a self-signed certificate and export it in PEM</p></li>
<li><p>Private key: the private key corresponding to the certificate</p></li>
<li><p>Rollover x509 certificate: Used when the x509 certificate is expiring. Can be set to a new certificate to publish in metadata.</p></li>
</ul>
<p>To generate a certificate, you can use this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-nodes<span class="w"> </span>-keyout<span class="w"> </span>private.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">9999</span><span class="w"> </span>-out<span class="w"> </span>cert.crt
</pre></div>
</div>
<p>Use the content of <cite>private.key</cite> and <cite>cert.crt</cite>.</p>
<p>Alternatively you can use <a class="reference external" href="https://developers.onelogin.com/saml/online-tools/x509-certs/obtain-self-signed-certs">this site</a> to generate a self-signed certificate.</p>
</section>
<section id="setup-the-identity-provider">
<h2>Setup the IDentity Provider<a class="headerlink" href="#setup-the-identity-provider" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Name: Visible to the user logging in. Example: “Institut Curie”</p></li>
<li><p>entityId: Example: <a class="reference external" href="https://idp1.agroparistech.fr/shibboleth">https://idp1.agroparistech.fr/shibboleth</a></p></li>
<li><p>SSO url: Single Sign On URL</p></li>
<li><p>SSO binding: Example: “<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</a>”</p></li>
<li><p>SLO url: Single Log Out URL</p></li>
<li><p>SLO binding: Example: “<a class="reference external" href="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect</a>”</p></li>
<li><p>x509 cert: the public key of the IDP</p></li>
</ul>
<section id="attributes-for-the-idp">
<h3>Attributes for the IDP<a class="headerlink" href="#attributes-for-the-idp" title="Link to this heading"></a></h3>
<p>We need to specify where to look in the attributes sent in the response for email, team and name of the user. You can use the FriendlyName or the Name from the table below. Note that this will depend on your IDP and using the SAML Tracer plugin (see below) to see the response will be helpful in determining what fields you want to use.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">SAML attributes</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>FriendlyName</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Email</p></td>
<td><p>mail</p></td>
<td><p><a class="reference external" href="urn:oid:0.9.2342.19200300.100.1.3">urn:oid:0.9.2342.19200300.100.1.3</a></p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Firstname</p></td>
<td><p>givenName</p></td>
<td><p><a class="reference external" href="urn:oid:2.5.4.42">urn:oid:2.5.4.42</a></p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>Lastname</p></td>
<td><p>sn</p></td>
<td><p><a class="reference external" href="urn:oid:2.5.4.4">urn:oid:2.5.4.4</a></p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>Userid (internal ID)</p></td>
<td><p>uid</p></td>
<td><p><a class="reference external" href="urn:oid:0.9.2342.19200300.100.1.1">urn:oid:0.9.2342.19200300.100.1.1</a></p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>If you cannot have information about the team, or do not wish to use it, make sure to have the setting “Let user select a team” when the user is created during first login.</p>
<p>Note that the metadata.xml file (accessible at <cite>/metadata.php</cite>) will contain a section informing the IDP of the requested attributes.</p>
<section id="about-the-userid-internal-id">
<h4>About the Userid / Internal ID<a class="headerlink" href="#about-the-userid-internal-id" title="Link to this heading"></a></h4>
<p>If you configure the <code class="docutils literal notranslate"><span class="pre">uid</span></code> (Userid/Internal ID) parameter for an IDP, the value will be read from the SAML assertion and:</p>
<ul class="simple">
<li><p>for user creation on the fly, the <code class="docutils literal notranslate"><span class="pre">orgid</span></code> (Organization ID) field of the user will contain the value of the <code class="docutils literal notranslate"><span class="pre">uid</span></code> attribute</p></li>
<li><p>for an existing user logging in, the <code class="docutils literal notranslate"><span class="pre">orgid</span></code> will not be modified</p></li>
</ul>
<p>If you enable “Fallback to internal id if existing user cannot be matched with email”, then the <code class="docutils literal notranslate"><span class="pre">uid</span></code> will be used to try and match an existing user if, during login, the match could not be done on the <code class="docutils literal notranslate"><span class="pre">email</span></code> field (user changed email for instance). You can then chose to enable “If user is matched with internal id, update the email sent by IDP?” so that the email sent by the IDP is updated in the local database.</p>
</section>
</section>
</section>
<section id="disable-local-login-register">
<h2>Disable local login/register<a class="headerlink" href="#disable-local-login-register" title="Link to this heading"></a></h2>
<p>Go to the Server tab of the Sysadmin panel. From there you can disable local login (to force SAML auth) and also disable local registration.</p>
</section>
<section id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Link to this heading"></a></h2>
<p>When a user successfully logins to the IDP, the email address is looked up. If it doesn’t exist, the user is created. If the team doesn’t exist either, it is created on the fly. You can configure this behavior from the Sysconfig panel.</p>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Link to this heading"></a></h2>
<p>SAML configuration can be tricky. I recommend that you use the SAML-tracer addon to see the requests and be able to verify what is sent and received.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://addons.mozilla.org/en-US/firefox/addon/saml-tracer/">link to addon for Firefox</a></p></li>
<li><p><a class="reference external" href="https://chrome.google.com/webstore/detail/saml-tracer/mpdajninpobndbfcldcmbpnnbhibjmch?hl=en">link to addon for Chrome</a></p></li>
</ul>
<p>Looking at the PHP logs will also be helpful to get the complete error message.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ldap.html" class="btn btn-neutral float-left" title="Configure LDAP authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debug.html" class="btn btn-neutral float-right" title="Debug" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012, Nicolas CARPi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
  <a href='https://creativecommons.org/licenses/by-sa/4.0/'><img src='_images/by-sa.png' alt='cc-by-sa' /></a>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>